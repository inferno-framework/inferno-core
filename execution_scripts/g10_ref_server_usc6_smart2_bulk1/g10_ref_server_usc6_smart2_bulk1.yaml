session:
  suite_id: g10_certification
  preset_id: g10-reference-server
  suite_options:
    us_core_version: us_core_6
    smart_app_launch_version: smart_app_launch_2
    multi_patient_version: multi_patient_api_stu1

rules:
  - status: created
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-g10_smart_standalone_patient_app"
  
  - status: waiting
    last_test: g10_certification-g10_smart_standalone_patient_app-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-g10_smart_standalone_patient_app-g10_token_incorrectly_permitted_tls_versions_messages_setup
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-g10_smart_limited_app" 

  - status: waiting
    last_test: g10_certification-g10_smart_limited_app-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_limited_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-g10_smart_limited_app-g10_restricted_resource_type_access-g10_us_core_6_medication_dispense_restricted_access
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-g10_smart_ehr_practitioner_app"  

  - status: waiting
    last_test: g10_certification-g10_smart_ehr_practitioner_app-smart_ehr_launch_stu2-smart_app_launch
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/perform_app_launch.rb {result_message}"

  - status: waiting
    last_test: g10_certification-g10_smart_ehr_practitioner_app-smart_ehr_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_launched_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-g10_smart_ehr_practitioner_app-g10_token_incorrectly_permitted_tls_versions_messages_setup
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-g10_single_patient_us_core_6_api"
    timeout: 600 # single patient API tests take a while

  - status: done
    last_test: g10_certification-g10_single_patient_us_core_6_api-g10_incorrectly_permitted_tls_versions_messages_setup
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-multi_patient_api"
    timeout: 600 # multi-patient API tests take a while

  - status: done
    last_test: g10_certification-multi_patient_api-g10_bulk_data_export_cancel_stu1-g10_bulk_export_cancel
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_public_standalone_launch_stu2"

  - status: waiting
    last_test: g10_certification-Group06-g10_public_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_public_standalone_launch_stu2-g10_public_launch_id_token
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/revoke_token_and_run_group.rb {session_id} 'g10_certification-Group06-g10_token_revocation' $INFERNO_URL"

  - status: done
    last_test: g10_certification-Group06-g10_token_revocation-Test03
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_invalid_aud"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_aud-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/invalid_launch_and_attest.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_smart_invalid_aud-Test04
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_invalid_token_request_stu2"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_token_request_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_smart_invalid_token_request_stu2-Test04
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group-smart_no_code_verifier_redirect
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group-smart_blank_code_verifier_redirect
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group-smart_bad_code_verifier_redirect
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"
  
  - status: waiting
    last_test: g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group-smart_plain_code_verifier_redirect
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_smart_invalid_pkce_code_verifier_group-smart_plain_code_verifier_token_request
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_ehr_patient_launch_stu2"

  - status: waiting
    last_test: g10_certification-Group06-g10_ehr_patient_launch_stu2-smart_app_launch
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/perform_app_launch.rb {result_message}"

  - status: waiting
    last_test: g10_certification-Group06-g10_ehr_patient_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_launched_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_ehr_patient_launch_stu2-g10_patient_scope
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_token_introspection"

  - status: waiting
    last_test: g10_certification-Group06-g10_token_introspection-smart_token_introspection_access_token_group-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_token_introspection-smart_token_introspection_response_group-Test02
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_asymmetric_launch"

  - status: waiting
    last_test: g10_certification-Group06-g10_asymmetric_launch-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_asymmetric_launch-g10_smart_asymmetric_token_refresh-g10_invalid_token_refresh
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_v1_scopes"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_v1_scopes-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_smart_v1_scopes-g10_token_incorrectly_permitted_tls_versions_messages_setup
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_fine_grained_scopes-Group01"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_fine_grained_scopes-Group01-us_core_smart_standalone_launch_stu2-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"
    timeout: 600 # granular scopes test take a while

  - status: done
    last_test: g10_certification-Group06-g10_smart_fine_grained_scopes-Group01-us_core_v610_observation_granular_scope_1_group-us_core_v610_Observation_granular_scope_read_test
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_fine_grained_scopes-Group02"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_fine_grained_scopes-Group02-us_core_smart_standalone_launch_stu2-smart_standalone_launch_stu2-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_all_scopes.rb {result_message}"
    timeout: 600 # granular scopes test take a while

  - status: done
    last_test: g10_certification-Group06-g10_smart_fine_grained_scopes-Group02-us_core_v610_observation_granular_scope_2_group-us_core_v610_Observation_granular_scope_read_test
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-Group06-g10_smart_granular_scope_selection"

  - status: waiting
    last_test: g10_certification-Group06-g10_smart_granular_scope_selection-g10_granular_scope_selection_v2_scopes-smart_app_redirect_stu2
    command: "bundle exec ruby execution_scripts/g10_ref_server_usc6_smart2_bulk1/authorize_85_granular_scopes.rb {result_message}"

  - status: done
    last_test: g10_certification-Group06-g10_smart_granular_scope_selection-g10_granular_scope_selection_v2_scopes-g10_smart_granular_scope_selection
    command: "bundle exec inferno session start_run '{session_id}' -r g10_certification-g10_visual_inspection_and_attestations"

  - status: done
    last_test: g10_certification-g10_visual_inspection_and_attestations-g10_clinical_test_scope_attestation
    command: END_SCRIPT

  
 