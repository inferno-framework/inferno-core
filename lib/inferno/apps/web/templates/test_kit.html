<!doctype html>
<html lang="en">
<head>
  <!-- Required meta tags -->
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <!-- Bootstrap CSS -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css" rel="stylesheet">

  <!-- Local styles -->
  <link rel="stylesheet" href="<%= Inferno::Application['public_path'] %>/common.css?v=<%= Inferno::VERSION %>">

  <!-- jQuery first, then Popper.js, then Bootstrap JS -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/2.9.3/umd/popper.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.min.js"></script>
  <script src="<%= Inferno::Application['public_path'] %>/bootstrap-toc-101.min.js"></script>

  <!-- Internal scripts -->
  <script src="<%= Inferno::Application['public_path'] %>/common.js?v=<%= Inferno::VERSION %>"></script>
  <script src="<%= Inferno::Application['public_path'] %>/session.js?v=<%= Inferno::VERSION %>"></script>
  <script src="<%= Inferno::Application['public_path'] %>/test_kits.js?v=<%= Inferno::VERSION %>"></script>

  <title><%= test_kit.title %></title>
</head>
  <body data-spy="scroll" data-target="#toc">
    <div class="flex-wrapper">
      <div>
        <div class="container-fluid">
          <h1 class="mt-4 mb-1"><%= test_kit.title %></h1>
          <div class="col-8 date-version-header">
            <% if test_kit.last_updated %>
            <time datetime="<%= DateTime.parse(test_kit.last_updated).strftime('%m/%d/%Y') %>" class="last-updated">
              <b>Last Updated:</b> <%= DateTime.parse(test_kit.last_updated).strftime('%B %-d, %Y') %>
            </time>
            <% end %>
            <% if test_kit.version %>
            <div class="version"><b>Test Kit Version:</b> <%= test_kit.version %></div>
            <% end %>
            <% if test_kit.maturity %>
            <div class="maturity"><b>Maturity:</b> <%= test_kit.maturity %>
              <a href="#" data-bs-toggle="modal" data-bs-target="#maturity-info-modal" title="About Maturity"><i
                                                                                                                class="bi bi-question-circle"></i></a>
            </div>
            <% end %>
          </div>
          <div>
            <% if test_kit.tags.present? %>
            <div class="tags mb-4">
              <% test_kit.tags.each do |tag| %>
              <div class="tag"><%= tag %></div>
              <% end %>
            </div>
            <% end %>
          </div>
          <div class="row">
            <div id="left-column">
              <%= Kramdown::Document.new(test_kit.description, input: 'GFM', hard_wrap: false).to_html %>
            </div>
            <div id="right-column">
              <div class="form-container">
                <form id="start-testing-form">
                  <h2 class="text-center fw-normal text-muted">Start Testing</h2>
                  <fieldset class="mb-3" <% if test_kit.suites.blank? || test_kit.suites.length < 2 %>style="display:none" <% end %>>
                    <legend class="form-title fs-6">Test Suite</legend>
                    <% test_kit.suites.each_with_index do |suite, index| %>
                    <div class="form-check">
                      <% if index.zero? %>
                      <input class="form-check-input" type="radio" name="suite" id="<%= suite.id %>" value="<%= suite.id %>"
                             checked>
                      <% else %>
                      <input class="form-check-input" type="radio" name="suite" id="<%= suite.id %>" value="<%= suite.id %>">
                      <% end %>
                      <label class="form-check-label" for="<%= suite.id %>">
                        <%= suite.title %>
                      </label>
                    </div>
                    <% end %>
                  </fieldset>
                  <!-- TODO -->
                  <% test_kit.suites.each do |suite| %>
                  <% suite.suite_options.each do |option| %>
                  <fieldset class="option-group mb-3" style="display: none"
                            data-option-group-for-suites="<%= suite.id %>">
                    <legend class="form-title fs-6"><%= option.title %></legend>
                    <% option.list_options.each_with_index do |list_option, option_index| %>
                    <div class="form-check">
                      <% if option_index.zero? || list_option[:value] == option.default %>
                      <input
                        class="form-check-input"
                        type="radio"
                        name="<%= option.id %>"
                        id="<%= "#{suite.id}-#{list_option[:value]}" %>"
                        value="<%= list_option[:value] %>"
                        checked
                        data-default="true">
                      <% else %>
                      <input
                        class="form-check-input"
                        type="radio"
                        name="<%= option.id %>"
                        id="<%= "#{suite.id}-#{list_option[:value]}" %>"
                        value="<%= list_option[:value] %>"
                      >
                      <% end %>
                      <label class="form-check-label" for="<%= "#{suite.id}-#{list_option[:value]}" %>">
                        <%= list_option[:label] %>
                      </label>
                    </div>
                    <% end %>
                  </fieldset>
                  <% end %>
                  <% end %>

                  <!-- Submit Button -->
                  <a class="btn btn-primary start-testing-button w-100" id="start-testing-button">
                    <i class="bi bi-plus-circle"></i>
                    Create Test Session
                  </a>
                </form>
              </div>
            </div>
          </div>
        </div>

        <div class="modal fade" id="maturity-info-modal" tabindex="-1" aria-labelledby="maturity-info-modal-label" aria-hidden="true">
          <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
              <div class="modal-header">
                <h5 class="modal-title" id="maturity-info-modal-label">About Test Kit Maturity</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
              </div>
              <div class="modal-body">
                <p>
                  Test Kits are broadly grouped into three levels of maturity:
                  <strong>High</strong>, <strong>Moderate</strong>, and
                  <strong>Low</strong>.  This is intended to provide guidance to users
                  on the level of confidence they should place in the accuracy and
                  completeness of these tests.
                </p>
                <p>
                  <strong>High</strong> maturity Test Kits typically have been
                  used to test many different systems against a stable specification
                  that has limited ambiguity.
                </p>
                <p>
                  <strong>Moderate</strong> and <strong>Low</strong> maturity Test Kits typically have
                  not had widespread usage and/or are targeting less mature
                  specifications that contain ambiguous or conflicting information.
                  These Test Kits are still of value to implementers, but they should be
                  aware of potential issues and are encouraged to contact the team with
                  problems as they arise.
                </p>
              </div>
              <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              </div>
            </div>
          </div>
        </div>

        <script>
         // Hook up the start testing button with the function
         $('#start-testing-button').click(() => {
           createSession();
         });

         // Handle hiding/unhiding the options depending on which suite is selected
         // Note that if there is only 1 suite, it won't show up for users
         // but it is still there.
         // Also force triggering this on load so if initial suite select has
         // options, those get opened.
         // And finally, if a suites share the same option names, as is common for
         // multiple versions of suites, this will auto-select the default option when
         // switching between suites.

         $('#start-testing-form input[type=radio][name=suite]').change(function () {
           const newSuite = this.value;

           $("#start-testing-form .option-group").css("display", "none");

           $("#start-testing-form .option-group").filter((index, el) => {
             const forSuites = $(el).data('option-group-for-suites');
             return forSuites.length === 0 || forSuites.split(",").indexOf(newSuite) > -1;

           }).css("display", "").find('input[data-default="true"]').prop('checked', true);

         }).filter(":checked").trigger('change');

         /* Full page vs narrow page styles */
         const leftColumn = document.getElementById('left-column');
         const rightColumn = document.getElementById('right-column');

         const updateStyles = () => {
           let fullView = window.innerWidth >= 500; // narrow view width threshold

           if (fullView) {
             leftColumn.classList.add('col-8');
             rightColumn.classList.add('col-4');

             leftColumn.classList.remove('second');
             rightColumn.classList.remove('first');
           } else {
             leftColumn.classList.remove('col-8');
             rightColumn.classList.remove('col-4');

             leftColumn.classList.add('second');
             rightColumn.classList.add('first');
           }
         };

         // Debounce resize listener
         let timeout = false; // holder for timeout id
         let delay = 200; // delay after event is "complete" to run callback

         addEventListener('resize', (event) => {
           // clear the timeout
           clearTimeout(timeout);
           // start timing for event "completion"
           timeout = setTimeout(updateStyles, delay);
         });

         updateStyles();
        </script>

        <style>
         .first {
           order: 1;
         }

         .second {
           order: 2;
         }

         .form-container {
           border: 1px solid #e0e0e0;
           border-radius: 10px;
           padding: 10px 20px 20px;
           /* Reduced top padding from 20px to 10px */
         }

         .form-title {
           font-size: 1.25rem;
           font-weight: 500;
           color: #777;
           margin-bottom: 10px;
         }

         .tag {
           font-size: 0.9rem;
           margin-right: 10px;
           padding: 2px 5px;
           background-color: #f2f2f2;
           border-radius: 4px;
           display: inline-block;
         }

         .date-version-header {
           display: flex;
           justify-content: space-between;
           flex-wrap: wrap;
           font-style: italic;
           padding-bottom: 10px;
         }

         .flex-wrapper {
           display: flex;
           min-height: 100vh;
           flex-direction: column;
           justify-content: space-between;
         }
        </style>
      </div>
    </div>
  </body>
</html>
